# Notebook Automation Tool

A comprehensive toolkit for managing course notes and resources in an Obsidian vault. The suite of scripts automates the process of converting course materials, generating index files, and organizing content for easy navigation and retrieval. It also supports advanced workflows for PDF and video reference note generation with OneDrive integration and AI-powered summaries.

## New Package Structure

The project has been reorganized into a proper Python package structure for better maintainability and ease of use. This new structure provides several benefits:

- Reliable imports between modules
- Easier installation and distribution
- Command-line entry points for common tasks
- Better organization and modularity
- Type hints and improved documentation

### Package Organization

```
mba_notebook_automation/
├── __init__.py              # Package metadata and version info
├── configure.py             # Configuration management
├── tools/                   # Core functionality modules
│   ├── utils/               # Utility functions
│   ├── pdf/                 # PDF processing tools
│   ├── auth/                # Authentication modules
│   ├── ai/                  # AI integration modules
│   └── ...
├── tags/                    # Tag management scripts
├── obsidian/                # Obsidian-specific tools
├── video/                   # Video processing tools
└── utilities/               # General helper scripts
```

### Getting Started

```bash
# Install in development mode
pip install -e .

# Run commands using entry points
mba-configure show
mba-add-nested-tags --dry-run --verbose
mba-generate-pdf-notes --help
mba-generate-video-metadata --help

# Or run modules directly
python -m mba_notebook_automation.configure show
python -m mba_notebook_automation.tags.add_nested_tags --dry-run --verbose
```

### Configuration

Configuration files are now stored in `~/.mba_notebook_automation/config.json` by default, making it easier to work with the package when installed system-wide.

### Migrating to the New Structure

For help migrating from the old structure, run:

```bash
python migrate_to_package.py
```

This script will guide you through the process and help update import statements in your custom scripts.

## Primary Scripts

The core functionality of this toolkit is provided by these primary scripts:

1. **`configure.py`**: Sets up the automation environment and configures paths
2. **`generate_markdown_from_html_and_text_in_vault.py`**: Converts HTML and text files to Markdown
3. **`generate_pdf_notes_from_onedrive.py`**: Creates notes from PDF files stored in OneDrive
4. **`generate_video_meta_from_onedrive.py`**: Extracts metadata from video files in OneDrive
5. **`generate-index_in_vault.py`**: Creates the hierarchical index structure for navigation
6. **`ensure_consistent_metadata.py`**: Ensures all files have consistent metadata
7. **`tags/add_nested_tags.py`**: Adds nested tags based on YAML frontmatter fields

## Workspace Organization

The repository is organized as follows:

- **Main Directory**: Contains the primary, actively used scripts (see [Primary Scripts](#primary-scripts) section above)
- **`/docs`**: Contains all documentation files and READMEs
- **`/tags`**: Contains tag management and generation scripts
- **`/tests`**: Contains all test scripts for the codebase
- **`/debug`**: Contains debugging and troubleshooting scripts
- **`/archived`**: Contains older versions and redundant scripts
- **`/tools`**: Core package with modular functionality used by scripts
- **`/utilities`**: Contains utility scripts and helper tools
- **`/obsidian`**: Contains Obsidian-specific tools and utilities
- **`/video`**: Contains video processing scripts
- **`/data`**: Contains data files and script results
- **`/cache`**: Contains authentication tokens and cache files
- **`/logs`**: Contains log files generated by the scripts

For a comprehensive overview of the workspace organization, including detailed listings of primary vs. supporting scripts, see [Final Organization](docs/final_organization.md).

For a list of planned tasks, improvements, and future enhancements, see the [Project Backlog](docs/project_backlog.md).

For detailed documentation on individual features, please see the files in the [docs](docs/) directory.

## Features

### File Conversion
- Converts HTML files to Markdown with proper formatting
- Converts transcript TXT files to Markdown
- Cleans up filenames by removing numbering prefixes and improving readability
- Adds YAML frontmatter with template type and auto-generated state properties
- Automatically adds appropriate titles to all generated files
- Before creating a file, the tool checks if it already exists in the target directory. If it does, the file will only be overwritten if the `--force` flag is set; otherwise, it will be skipped and a message will be shown.

### Index Generation
- Creates a hierarchical structure of index files for easy navigation
- Supports a 6-level hierarchy: Main → Program → Course → Class → Module → Lesson
- Generates Obsidian-compatible wiki-links between index levels
- Creates back-navigation links for seamless browsing (with correct filenames)
- Respects "readonly" marked files to prevent overwriting customized content

### PDF & Video Reference Note Generation
- Scans PDFs and videos from OneDrive MBA-Resources folder
- Authenticates with Microsoft Graph API for secure access to OneDrive
- Creates shareable links for PDFs and videos stored in OneDrive
- Generates markdown notes in the Obsidian vault with both local file:// links and shareable OneDrive links
- Extracts text from PDFs and transcripts, generating AI-powered summaries and tags (OpenAI integration)
- Infers course and program information from file paths
- Maintains consistent folder structure between OneDrive and Obsidian vault
- Robust error handling, retry mechanism, and secure token management
- Preserves user modifications to notes (respects auto-generated-state flag)
- Supports dry-run, retry, and force-overwrite modes

### Content Organization
- Automatically categorizes content into readings, videos, transcripts, etc.
- Adds appropriate icons for different content types
- Implements an advanced nested tagging system for enhanced content discovery
- Supports program, course, term, content type, and workflow tags

### Nested Tag System
- Hierarchical tag structure with forward slashes for nesting (e.g., `type/note/lecture`)
- Automatically detects and applies course codes, terms, and subject areas
- Includes program information (`program/imba`), course codes (`course/FIN501`), and terms (`term/2024-spring`)
- Organizes by content type, subject area, skills, tools, status, and priority
- Fully supports Obsidian's tag pane and Dataview plugin

## Directory Structure

The tool expects and generates the following directory structure:
```
- Root (main-index)
  - Program Folders (program-index)
    - Course Folders (course-index)
      - Class Folders (class-index)
        - Case Study Folders (case-study-index)
        - Module Folders (module-index)
          - Live Session Folder (live-session-index)
          - Lesson Folders (lesson-index)
            - Content Files (readings, videos, transcripts, etc.)
```

## Installation

1. Clone this repository:
```
git clone https://github.com/danielshue/notebook-automation.git
```

2. Install the required dependencies:
```
pip install pyyaml html2text requests msal openai python-dotenv cryptography urllib3
```

## Usage

The toolkit provides several command-line options across its scripts:

- **Convert files only**:
  ```
  python generate_markdown_from_html_and_text_in_vault.py --convert --source <path>
  ```

- **Generate indexes only**:
  ```
  python generate-index_in_vault.py --generate-index --source <path>
  ```

- **Generate PDF notes from OneDrive**:
  ```
  python generate_pdf_notes_from_onedrive.py --folder <folder> [--force] [--dry-run] [--no-share-links]
  ```

- **Generate video notes from OneDrive**:
  ```
  python generate_video_meta_from_onedrive.py --folder <folder> [--force] [--dry-run] [--no-summary]
  ```

- **Perform both conversion and index generation**:
  ```
  python generate-index_in_vault.py --all --source <path>
  ```

## Examples

Convert HTML/TXT files and generate indexes for a specific course:
```
python generate_markdown_from_html_and_text_in_vault.py --all --source /path/to/accounting-for-managers
```

Generate PDF notes for all files in a OneDrive folder:
```
python generate_pdf_notes_from_onedrive.py --folder "Value Chain Management/Managerial Accounting Business Decisions/Case Studies" --force
```

Generate video notes for a single video file:
```
python generate_video_meta_from_onedrive.py -f "Value Chain Management/Managerial Accounting Business Decisions/Module 1/Video1.mp4" --force
```

## Templater Integration

The tool includes Templater templates for Obsidian that can be used to create standardized notes:

- **Lesson Note**: Template for creating structured lesson notes with sections for summary, key points, questions, and action items.

## Command Line Arguments

- `--source`: Directory to process - can be any level in the hierarchy (required for most scripts)
- `--convert`: Convert HTML and TXT files to Markdown
- `--generate-index`: Generate indexes for the directory structure
- `--all`: Perform both conversion and index generation
- `--folder`: Process all PDFs or videos in a specific OneDrive subfolder
- `-f`, `--single-file`: Process only a single PDF or video file
- `--force`: Overwrite existing notes/files if they exist
- `--dry-run`: Test without making changes
- `--no-share-links`: Skip OneDrive shared links (for PDF script)
- `--no-summary`: Skip OpenAI summary generation (for video script)
- `--retry-failed`: Only retry previously failed files
- `--timeout`: Set custom API request timeout (seconds)
- `--debug`: Enable debug logging

## Requirements

- Python 3.6+
- pyyaml, html2text, requests, msal, openai, python-dotenv, cryptography, urllib3
- Obsidian (for viewing and working with the generated files)

## License

MIT

## Author

Daniel Shue
