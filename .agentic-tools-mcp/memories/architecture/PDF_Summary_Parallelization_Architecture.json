{
  "id": "0891adca-3fe4-4b6d-bb4d-54beafdd7b47",
  "title": "PDF Summary Parallelization Architecture",
  "details": "PDF summary processing has multilevel parallelization:\n\n1. **File-level parallelization**: DocumentNoteBatchProcessor supports parallel processing of multiple PDF files via ProcessFilesInParallelAsync method, controlled by maxFileParallelism configuration.\n\n**Configuration Details**:\n- AIServiceConfig.MaxFileParallelism has a default of **4**\n- DocumentNoteBatchProcessor now uses a consistent fallback default of **4** when appConfig is null: `appConfig?.AiService?.Timeout?.MaxFileParallelism ?? 4`\n- This ensures files are processed in parallel by default (up to 4 simultaneously)\n\n2. **Chunk-level parallelization**: AISummarizer implements ProcessChunksInParallelAsync for parallel processing of text chunks within a single document, controlled by MaxChunkParallelism configuration (default 3).\n\n**Key Architecture Details**:\n- PdfNoteProcessor.GeneratePdfSummaryAsync calls AISummarizer.SummarizeWithVariablesAsync\n- AISummarizer automatically chunks large texts and processes chunks in parallel if MaxChunkParallelism > 1 and chunks.Count > 1\n- Uses SemaphoreSlim for concurrency control and rate limiting with configurable delays\n- Maintains chunk order in final summary\n- Rate limiting controlled by ChunkRateLimitMs (default 100ms)\n\n**Configuration Defaults**:\n- MaxFileParallelism: 4 (consistent across config class and fallback)\n- MaxChunkParallelism: 3 (controls parallel chunk processing)\n- FileRateLimitMs: 200ms (rate limiting for file processing) \n- ChunkRateLimitMs: 100ms (rate limiting for chunk processing)\n\n**Decision Logic**: Files are processed in parallel when `maxFileParallelism > 1 && files.Count > 1`, which now defaults to true for multiple files.\n\nThe functionality is pushed down to the AISummarizer service for chunk-level parallelization, but file-level parallelization is handled by DocumentNoteBatchProcessor.",
  "category": "architecture",
  "dateCreated": "2025-06-15T23:48:51.902Z",
  "dateUpdated": "2025-06-15T23:52:57.399Z"
}