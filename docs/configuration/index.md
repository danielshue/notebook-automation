# Configuration

Configure Notebook Automation for your specific needs and environment.

## Overview

Notebook Automation uses a flexible configuration system that supports:
- JSON configuration files
- Environment variables
- Command-line arguments
- User secrets for sensitive data

## Configuration Files

### Main Configuration

The primary configuration file is `config/config.json`:

```json
{
  "NotebookSettings": {
    "InputDirectory": "input",
    "OutputDirectory": "output",
    "BackupDirectory": "backup",
    "TemplateDirectory": "templates"
  },
  "ProcessingOptions": {
    "EnableMetadataExtraction": true,
    "EnableTagGeneration": true,
    "EnableContentSummary": true,
    "ParallelProcessing": false
  },
  "LoggingSettings": {
    "LogLevel": "Information",
    "LogToFile": true,
    "LogFilePath": "logs/notebookautomation.log"
  }
}
```

### Example Configurations

See the `config/` directory for example configurations:
- `config.json` - Basic configuration
- `example-config-with-timeout.json` - Configuration with timeout settings

### Metadata Configuration

Customize metadata extraction using `config/metadata.yaml`:

```yaml
metadata:
  course:
    required_fields:
      - name
      - code
      - instructor
    optional_fields:
      - semester
      - year

  assignment:
    required_fields:
      - title
      - due_date
    optional_fields:
      - points
      - description
```

## Environment Variables

Override configuration settings using environment variables:

```bash
# Core settings
NOTEBOOK_INPUT_DIR="C:\MyNotebooks"
NOTEBOOK_OUTPUT_DIR="C:\ProcessedNotebooks"

# Processing options
NOTEBOOK_ENABLE_METADATA=true
NOTEBOOK_ENABLE_TAGS=true
NOTEBOOK_PARALLEL_PROCESSING=false

# Logging
NOTEBOOK_LOG_LEVEL=Debug
NOTEBOOK_LOG_FILE="logs/debug.log"
```

## User Secrets

Store sensitive configuration data securely using .NET User Secrets:

```bash
# Initialize user secrets
dotnet user-secrets init --project src/c-sharp/NotebookAutomation.Core

# Add API keys or sensitive settings
dotnet user-secrets set "OpenAI:ApiKey" "your-api-key-here"
dotnet user-secrets set "Azure:ConnectionString" "your-connection-string"
```

## Command Line Arguments

Override any configuration setting from the command line:

```bash
# Basic usage with config overrides
NotebookAutomation.exe --input "C:\Notes" --output "C:\Processed" --log-level Debug

# Processing options
NotebookAutomation.exe --enable-metadata --disable-tags --parallel
```

## Configuration Hierarchy

Settings are applied in the following order (later sources override earlier ones):

1. Default configuration values
2. Configuration files (`config/config.json`)
3. Environment variables
4. User secrets
5. Command-line arguments

## Template Configuration

Customize output templates by modifying files in the `templates/` directory:

### Block Templates

Edit `config/BaseBlockTemplate.yaml` to customize how notebook blocks are processed:

```yaml
template:
  header: |
    ## {block_type}: {title}
    **Created:** {timestamp}

  content: |
    {content}

  footer: |
    ---
    *Generated by Notebook Automation*
```

### Custom Templates

Create custom templates for specific notebook types:

```yaml
# templates/course-template.yaml
course_template:
  metadata_section: |
    # Course: {course_name}
    **Code:** {course_code}
    **Instructor:** {instructor}
    **Semester:** {semester}

  assignment_section: |
    ## Assignment: {assignment_title}
    **Due Date:** {due_date}
    **Points:** {points}
```

## Banner Configuration

Configure custom banners for generated markdown files using the `banners` section in `config.json`:

### Basic Banner Configuration

```json
{
  "banners": {
    "enabled": true,
    "default": "gies-banner.png",
    "format": "image",
    "template_banners": {
      "main": "main-banner.png",
      "program": "program-banner.png",
      "course": "course-banner.png"
    },
    "filename_patterns": {
      "*index*": "index-banner.png",
      "*assignment*": "assignment-banner.png"
    }
  }
}
```

### Banner Configuration Options

| Setting | Description | Default |
|---------|-------------|---------|
| `enabled` | Global enable/disable for banner functionality | `true` |
| `default` | Default banner content when no specific match is found | `"gies-banner.png"` |
| `format` | Banner format type: `image`, `text`, `markdown`, `html` | `"image"` |
| `template_banners` | Banner content by template type | See defaults |
| `filename_patterns` | Banner content by filename patterns (wildcards supported) | `{}` |

### Banner Selection Priority

The system selects banners in the following order (first match wins):

1. **Existing banner**: If frontmatter already contains a banner, it's preserved
2. **Filename patterns**: Matches filename against wildcard patterns
3. **Template types**: Matches `template-type` frontmatter field
4. **Default fallback**: Uses default banner for backward compatibility

### Filename Pattern Examples

```json
{
  "filename_patterns": {
    "*index*": "index-banner.png",        // Matches: index.md, course-index.md, etc.
    "assignment-*": "assignment-banner.png", // Matches: assignment-1.md, assignment-final.md
    "*.course.*": "course-banner.png",    // Matches: mba.course.md, intro.course.notes.md
    "main": "main-banner.png"             // Exact match: main.md
  }
}
```

### Banner Format Types

- **`image`**: Obsidian-style image references (default behavior)
- **`text`**: Plain text content
- **`markdown`**: Markdown formatted content  
- **`html`**: HTML formatted content

### Disabling Banners

To disable banner functionality entirely:

```json
{
  "banners": {
    "enabled": false
  }
}
```

## Validation

The configuration system includes built-in validation:

- **Required fields** - Essential settings must be provided
- **Type checking** - Values must match expected data types
- **Path validation** - Directory paths must exist or be creatable
- **Dependency checks** - Related settings are validated together

## Troubleshooting Configuration

### Common Issues

**Configuration not loading:**
- Check file path and permissions
- Verify JSON syntax using a validator
- Review log output for specific error messages

**Environment variables not recognized:**
- Ensure proper naming convention (NOTEBOOK_SETTING_NAME)
- Check for typos in variable names
- Verify variables are set in the correct scope

**User secrets not accessible:**
- Confirm user secrets are initialized for the project
- Check that secret names match configuration keys
- Verify the user secrets store is accessible

### Debug Configuration

Enable detailed configuration logging:

```json
{
  "Logging": {
    "LogLevel": {
      "NotebookAutomation.Configuration": "Debug"
    }
  }
}
```

## Advanced Configuration

### Custom Configuration Providers

Extend the configuration system with custom providers:

```csharp
public class DatabaseConfigurationProvider : ConfigurationProvider
{
    public override void Load()
    {
        // Load configuration from database
        var settings = LoadFromDatabase();
        Data = settings.ToDictionary(s => s.Key, s => s.Value);
    }
}
```

### Configuration Validation Attributes

Use data annotations for configuration validation:

```csharp
public class NotebookSettings
{
    [Required]
    [DirectoryExists]
    public string InputDirectory { get; set; }

    [Range(1, 100)]
    public int MaxConcurrentFiles { get; set; }
}
```

## See Also

- [Getting Started](../getting-started/index.md) - Initial setup and basic usage
- [User Guide](../user-guide/index.md) - Comprehensive usage documentation
- [Troubleshooting](../troubleshooting/index.md) - Common issues and solutions
- [Developer Guide](../developer-guide/index.md) - Development and contribution guidelines
